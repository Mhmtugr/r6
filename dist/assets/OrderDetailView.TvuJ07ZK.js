var a=Object.defineProperty,e=(e,i)=>a(e,"name",{value:i,configurable:!0});import{r as i,c as s,U as t,w as l,u as r,o as n,i as d,k as o,b as c,j as u,x as m,t as y,y as v,m as p,B as g,z as b,p as k,v as f,F as h,q as w,l as z}from"./vendor-vue.Cn8zEwKq.js";import{a as x,d as S,e as O,_ as A}from"./index.DR3g4u-R.js";import"./vendor-firebase.4azA1Kf8.js";import"./vendor-chart.By1hop_s.js";const D=e((()=>{const a=t(),n=r(),d=x(),o=i(null),c=i(!0),u=i(!1),m=i(null),y=i([]),v=i([]),p=i([]),g=i([]),b=i({text:"",priority:"normal",assignedTo:null}),k=i(!1),f=i([]),h=i([]),w=s((()=>a.params.id)),z=s((()=>{var a;return(null==(a=o.value)?void 0:a.orderNo)||""})),A=s((()=>{var a,e;return(null==(e=null==(a=o.value)?void 0:a.customerInfo)?void 0:e.name)||""})),D=s((()=>{if(!o.value)return!1;const a=new Date,e=new Date(o.value.deliveryDate);return"completed"!==o.value.status&&e<a})),T=s((()=>{if(!o.value)return"";switch(o.value.status){case"planned":return"bg-info";case"in_progress":return"bg-primary";case"delayed":return"bg-danger";case"completed":return"bg-success";default:return"bg-secondary"}})),C=s((()=>{if(!o.value)return"";switch(o.value.status){case"planned":return"Planlandı";case"in_progress":return"Üretimde";case"delayed":return"Gecikmiş";case"completed":return"Tamamlandı";default:return"Belirsiz"}})),N=s((()=>g.value.some((a=>"critical"===a.priority&&!a.resolved)))),$=s((()=>g.value.some((a=>"warning"===a.priority&&!a.resolved)))),I=e((async()=>{c.value=!0;try{const a=await S.get(`/orders/${w.value}`);o.value=a.data,await Promise.all([E(),_(),H(),B()])}catch(a){d.add({title:"Hata",message:"Sipariş bilgileri yüklenemedi.",type:"danger"})}finally{c.value=!1}}),"loadOrder"),E=e((async()=>{try{const a=await S.get(`/orders/${w.value}/notes`);g.value=a.data}catch(a){}}),"loadOrderNotes"),_=e((async()=>{try{const a=await S.get(`/orders/${w.value}/timeline`);p.value=a.data}catch(a){}}),"loadOrderTimeline"),H=e((async()=>{try{const a=await S.get(`/orders/${w.value}/production`);f.value=a.data.steps||[],h.value=a.data.data||[]}catch(a){}}),"loadProductionSteps"),B=e((async()=>{try{const a=await S.get(`/orders/${w.value}/materials`);v.value=a.data}catch(a){}}),"loadRelatedMaterials"),P=e((async()=>{if(!u.value&&o.value){u.value=!0;try{const a=await O.analyzeOrder(w.value);m.value=a,j(),d.add({title:"AI Analizi",message:"Sipariş analizi tamamlandı.",type:"info"})}catch(a){d.add({title:"AI Analizi Hatası",message:"Sipariş analizi yapılamadı.",type:"danger"})}finally{u.value=!1}}}),"performAIAnalysis"),j=e((()=>{const a=[];if(o.value){D.value&&(a.push({text:"Gecikme analizi yap",action:"analyze-delay"}),a.push({text:"Müşteriye bildirim gönder",action:"notify-customer"})),N.value&&a.push({text:"Kritik sorunları incele",action:"review-issues"}),"in_progress"===o.value.status&&a.push({text:"Üretim sürecini hızlandırma önerileri",action:"optimize-production"});v.value.filter((a=>"missing"===a.status||"critical"===a.status)).length>0&&a.push({text:"Eksik malzemeleri incele",action:"review-materials"})}y.value=a}),"generateAISuggestions"),L=e((a=>{if(!a)return"";let e=a.replace(/(\bkritik\b|\böncelikli\b|\bacil\b|\bgecikmeli\b|\bkırmızı\b)/gi,'<span class="danger">$1</span>').replace(/(\btamamlandı\b|\bbaşarılı\b|\btamam\b|\bzamanında\b|\byeşil\b)/gi,'<span class="success">$1</span>').replace(/(malzeme eksikliği|tedarik sorunu|stok sorunu|üretim gecikmesi)/gi,'<span class="highlight">$1</span>');return e=e.replace(/\n/g,"<br>"),e}),"formatAnalysisText"),M=e((async a=>{switch(a){case"analyze-delay":await G();break;case"notify-customer":Y();break;case"review-issues":K("notes-section");break;case"optimize-production":await R();break;case"review-materials":K("materials-section")}}),"handleSuggestion"),G=e((async()=>{try{u.value=!0;const a=await O.analyzeOrderDelay(w.value);m.value=a,d.add({title:"Gecikme Analizi",message:"Sipariş gecikme analizi tamamlandı.",type:"info"})}catch(a){d.add({title:"Analiz Hatası",message:"Gecikme analizi yapılamadı.",type:"danger"})}finally{u.value=!1}}),"analyzeOrderDelay"),Y=e((()=>{d.add({title:"Bildirim",message:"Müşteri bildirim özelliği yakında eklenecek.",type:"info"})}),"showCustomerNotificationModal"),K=e((a=>{const e=document.getElementById(a);e&&e.scrollIntoView({behavior:"smooth",block:"start"})}),"scrollToSection"),R=e((async()=>{try{u.value=!0;const a=await O.getProductionOptimizationOptions(w.value);m.value=a,d.add({title:"Üretim Optimizasyonu",message:"Optimizasyon önerileri hazırlandı.",type:"info"})}catch(a){d.add({title:"Öneri Hatası",message:"Optimizasyon önerileri alınamadı.",type:"danger"})}finally{u.value=!1}}),"showProductionOptimizationOptions"),U=e((async()=>{if(b.value.text.trim()&&!k.value){k.value=!0;try{const a={orderId:w.value,text:b.value.text,priority:b.value.priority,assignedTo:b.value.assignedTo,createdAt:new Date,resolved:!1};await S.post(`/orders/${w.value}/notes`,a);await E(),b.value={text:"",priority:"normal",assignedTo:null},d.add({title:"Not Eklendi",message:"Sipariş notu başarıyla eklendi.",type:"success"})}catch(a){d.add({title:"Hata",message:"Not eklenemedi.",type:"danger"})}finally{k.value=!1}}}),"addNote"),V=e((async a=>{try{await S.patch(`/orders/${w.value}/notes/${a}`,{resolved:!0}),await E(),d.add({title:"Not Çözüldü",message:"Sipariş notu çözüldü olarak işaretlendi.",type:"success"})}catch(e){d.add({title:"Hata",message:"Not güncellenemedi.",type:"danger"})}}),"resolveNote"),Z=e((async a=>{try{await S.patch(`/orders/${w.value}`,{status:a}),await I(),d.add({title:"Durum Güncellendi",message:"Sipariş durumu güncellendi.",type:"success"}),j()}catch(e){d.add({title:"Hata",message:"Sipariş durumu güncellenemedi.",type:"danger"})}}),"updateOrderStatus"),q=e((()=>{n.push({name:"OrderList"})}),"goBack");return l((()=>a.params.id),(a=>{a&&I()}),{immediate:!0}),{order:o,isLoading:c,isEditing:i(!1),isAnalyzing:u,aiAnalysis:m,aiSuggestions:y,relatedMaterials:v,timeline:p,notes:g,newNote:b,noteLoading:k,productionSteps:f,productionData:h,orderId:w,orderNo:z,customerName:A,isDelayed:D,orderStatusClass:T,orderStatusText:C,hasCriticalNotes:N,hasWarningNotes:$,orderProgress:s((()=>{var a;return(null==(a=o.value)?void 0:a.progress)||0})),orderCellCount:s((()=>{var a,e;return(null==(e=null==(a=o.value)?void 0:a.cells)?void 0:e.length)||0})),loadOrder:I,performAIAnalysis:P,formatAnalysisText:L,handleSuggestion:M,addNote:U,resolveNote:V,updateOrderStatus:Z,goBack:q,startEditing:e((()=>{}),"startEditing"),cancelEditing:e((()=>{}),"cancelEditing"),saveChanges:e((async()=>{}),"saveChanges"),deleteOrder:e((async()=>{}),"deleteOrder"),cloneOrder:e((async()=>{}),"cloneOrder"),getStatusText:e((a=>({planned:"Planlandı",in_progress:"Üretimde",delayed:"Gecikmiş",completed:"Tamamlandı",canceled:"İptal Edildi"}[a]||a)),"getStatusText"),getStatusBadgeClass:e((a=>({planned:"bg-info",in_progress:"bg-primary",delayed:"bg-danger",completed:"bg-success",canceled:"bg-secondary"}[a]||"bg-secondary")),"getStatusBadgeClass")}}),"useOrderDetail"),T={class:"order-detail"},C={key:0,class:"text-center py-5"},N={key:1,class:"alert alert-warning"},$={key:2},I={class:"d-flex justify-content-between align-items-start mb-4"},E={class:"text-muted"},_={class:"d-flex gap-2"},H={class:"card mb-4"},B={class:"card-body"},P={class:"row"},j={class:"col-md-3"},L={class:"d-flex align-items-center"},M={class:"col-md-6"},G={class:"d-flex align-items-center"},Y={class:"progress flex-grow-1"},K=["aria-valuenow"],R={class:"col-md-3"},U={class:"d-flex align-items-center"},V={class:"card mb-4"},Z={class:"card-header d-flex justify-content-between align-items-center"},q=["disabled"],F={key:0,class:"spinner-border spinner-border-sm me-1",role:"status"},W={class:"card-body"},J={key:0,class:"text-center py-3"},Q={key:1,class:"text-center py-3"},X={key:2},aa={key:0,class:"mb-4"},ea=["innerHTML"],ia={key:1,class:"mt-4"},sa={class:"row g-3 mt-1"},ta={class:"card h-100 suggestion-card"},la={class:"card-body"},ra={class:"card-text"},na={class:"card-footer bg-transparent"},da=["onClick"],oa={key:0,class:"card mb-4"},ca={key:3,class:"modal fade show",style:{display:"block"}},ua={key:4,class:"modal fade show",style:{display:"block"}},ma=A({__name:"OrderDetailView",setup(a){r();const{order:s,isLoading:t,isEditing:l,isAnalyzing:x,aiAnalysis:S,aiSuggestions:O,orderProgress:A,loadOrderDetail:ma,performAIAnalysis:ya,startEditing:va,getStatusText:pa,getStatusBadgeClass:ga,formatAnalysisText:ba,handleSuggestion:ka}=D(),fa=i(!1),ha=i(!1);function wa(){fa.value=!0}function za(){ha.value=!0}return i(!1),e(wa,"confirmDelete"),e(za,"confirmClone"),n((()=>{ma()})),(a,i)=>{const r=b("router-link");return z(),d("div",T,[c(t)?(z(),d("div",C,i[2]||(i[2]=[u("div",{class:"spinner-border text-primary",role:"status"},[u("span",{class:"visually-hidden"},"Yükleniyor...")],-1)]))):c(s)?(z(),d("div",$,[u("div",I,[u("div",null,[u("h1",null,y(c(s).orderNo),1),u("p",E," Sipariş Tarihi: "+y(new Date(c(s).orderDate).toLocaleDateString("tr-TR")),1)]),u("div",_,[c(l)?o("",!0):(z(),d("button",{key:0,onClick:i[0]||(i[0]=(...a)=>c(va)&&c(va)(...a)),class:"btn btn-outline-primary"},i[3]||(i[3]=[u("i",{class:"bi bi-pencil me-1"},null,-1),p(" Düzenle ")]))),c(l)?o("",!0):(z(),d("button",{key:1,onClick:za,class:"btn btn-outline-secondary"},i[4]||(i[4]=[u("i",{class:"bi bi-copy me-1"},null,-1),p(" Kopyala ")]))),c(l)?o("",!0):(z(),d("button",{key:2,onClick:wa,class:"btn btn-outline-danger"},i[5]||(i[5]=[u("i",{class:"bi bi-trash me-1"},null,-1),p(" Sil ")]))),v(r,{to:{name:"Orders"},class:"btn btn-outline-secondary"},{default:g((()=>i[6]||(i[6]=[u("i",{class:"bi bi-arrow-left me-1"},null,-1),p(" Siparişler ")]))),_:1})])]),u("div",H,[u("div",B,[u("div",P,[u("div",j,[u("div",L,[i[7]||(i[7]=u("span",{class:"me-2"},"Durum:",-1)),u("span",{class:k(["badge",c(ga)(c(s).status)])},y(c(pa)(c(s).status)),3)])]),u("div",M,[u("div",G,[i[8]||(i[8]=u("span",{class:"me-2"},"İlerleme:",-1)),u("div",Y,[u("div",{class:k(["progress-bar",{"bg-success":100===c(A),"bg-info":c(A)>=75&&c(A)<100,"bg-primary":c(A)>=50&&c(A)<75,"bg-warning":c(A)>=25&&c(A)<50,"bg-danger":c(A)<25}]),role:"progressbar",style:f(`width: ${c(A)}%`),"aria-valuenow":c(A),"aria-valuemin":"0","aria-valuemax":"100"},y(c(A))+"% ",15,K)])])]),u("div",R,[u("div",U,[i[9]||(i[9]=u("span",{class:"me-2"},"Öncelik:",-1)),u("span",{class:k(["badge",{"bg-danger":"high"===c(s).priority,"bg-warning":"medium"===c(s).priority,"bg-info":"low"===c(s).priority}])},y("high"===c(s).priority?"Yüksek":"medium"===c(s).priority?"Orta":"low"===c(s).priority?"Düşük":"Normal"),3)])])])])]),u("div",V,[u("div",Z,[i[10]||(i[10]=u("h5",{class:"mb-0"},[u("i",{class:"bi bi-robot me-2"}),p(" Yapay Zeka Analizi ")],-1)),u("button",{class:k(["btn btn-sm",c(x)?"btn-secondary disabled":"btn-primary"]),onClick:i[1]||(i[1]=(...a)=>c(ya)&&c(ya)(...a)),disabled:c(x)},[c(x)?(z(),d("span",F)):o("",!0),p(" "+y(c(x)?"Analiz yapılıyor...":"Analizi Yenile"),1)],10,q)]),u("div",W,[c(x)?(z(),d("div",J,i[11]||(i[11]=[u("div",{class:"spinner-border text-primary",role:"status"},[u("span",{class:"visually-hidden"},"Analiz yapılıyor...")],-1),u("p",{class:"mt-2 text-muted"},"Siparişiniz yapay zeka tarafından analiz ediliyor...",-1)]))):c(S)||c(O).length?(z(),d("div",X,[c(S)?(z(),d("div",aa,[i[13]||(i[13]=u("h6",null,"Sipariş Değerlendirmesi:",-1)),u("p",{class:"analysis-text",innerHTML:c(ba)(c(S))},null,8,ea)])):o("",!0),c(O).length?(z(),d("div",ia,[i[15]||(i[15]=u("h6",null,"Yapay Zeka Önerileri:",-1)),u("div",sa,[(z(!0),d(h,null,w(c(O),(a=>(z(),d("div",{key:a.action,class:"col-md-6 col-lg-4"},[u("div",ta,[u("div",la,[u("p",ra,y(a.text),1)]),u("div",na,[u("button",{class:"btn btn-sm btn-outline-primary",onClick:e((e=>c(ka)(a.action)),"onClick")},i[14]||(i[14]=[u("i",{class:"bi bi-lightning me-1"},null,-1),p(" Uygula ")]),8,da)])])])))),128))])])):o("",!0)])):(z(),d("div",Q,i[12]||(i[12]=[u("i",{class:"bi bi-lightbulb fs-1 text-warning"},null,-1),u("p",{class:"mt-2"},'Henüz bir analiz yapılmamış. "Analizi Yenile" butonuna tıklayarak sipariş hakkında yapay zeka değerlendirmesi alabilirsiniz.',-1)])))])]),c(l)?(z(),d("div",oa)):o("",!0),i[16]||(i[16]=m('<div class="row" data-v-e2fe5d4c><div class="col-lg-6" data-v-e2fe5d4c><div class="card mb-4" data-v-e2fe5d4c></div></div><div class="col-lg-6" data-v-e2fe5d4c><div class="card mb-4" data-v-e2fe5d4c></div></div></div><div class="card mb-4" data-v-e2fe5d4c></div><div class="card mb-4" data-v-e2fe5d4c></div><div class="card mb-4" data-v-e2fe5d4c></div>',4))])):(z(),d("div",N," Sipariş bulunamadı veya erişim yetkiniz yok. ")),fa.value?(z(),d("div",ca)):o("",!0),ha.value?(z(),d("div",ua)):o("",!0)])}}},[["__scopeId","data-v-e2fe5d4c"]]);export{ma as default};
