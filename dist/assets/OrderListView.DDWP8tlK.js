var e=Object.defineProperty,t=(t,a)=>e(t,"name",{value:a,configurable:!0});import{r as a,a as r,c as s,w as l,i as n,j as i,m as o,k as d,C as c,D as u,b as p,E as m,F as g,q as y,p as f,G as v,u as h,z as k,l as b,t as A,v as D,y as w,B as P}from"./vendor-vue.Cn8zEwKq.js";import{c as C,_ as L}from"./index.DR3g4u-R.js";import"./vendor-firebase.4azA1Kf8.js";import"./vendor-chart.By1hop_s.js";function T(){const{showToast:e}=C(),n=a([]),i=a(!1),o=a(0),d=r({searchQuery:"",cellType:"",status:"",dateRange:{start:"",end:""},priorityLevel:"",customerName:"",riskLevel:""}),c=r({field:"orderDate",direction:"desc"}),u=r({currentPage:1,itemsPerPage:10,totalPages:s((()=>Math.ceil(m.value.length/u.itemsPerPage)))}),p=a(!1),m=s((()=>{let e=[...n.value];if(d.searchQuery){const t=d.searchQuery.toLowerCase();e=t.includes("geciken")||t.includes("gecikmiş")?e.filter((e=>"delayed"===e.status)):t.includes("tamamlan")||t.includes("biten")?e.filter((e=>"completed"===e.status)):t.includes("üretimde")||t.includes("devam eden")?e.filter((e=>"in_progress"===e.status)):t.includes("yüksek öncelik")||t.includes("acil")?e.filter((e=>"high"===e.priority)):t.includes("risk")?e.filter((e=>"high"===e.riskLevel)):e.filter((e=>{var a,r,s;return(null==(a=e.orderNo)?void 0:a.toLowerCase().includes(t))||(null==(s=null==(r=e.customerInfo)?void 0:r.name)?void 0:s.toLowerCase().includes(t))||e.cells&&e.cells.some((e=>{var a;return null==(a=e.productTypeCode)?void 0:a.toLowerCase().includes(t)}))}));const a=t.match(/([a-zA-ZşŞıİçÇöÖüÜğĞ]+)'[ıiuünña]n/i);if(a){const t=a[1].toUpperCase();e=e.filter((e=>{var a,r;return null==(r=null==(a=e.customerInfo)?void 0:a.name)?void 0:r.toUpperCase().includes(t)}))}}return d.cellType&&(e=e.filter((e=>!(!e.cells||!e.cells.length)&&e.cells.some((e=>{var t;return null==(t=e.productTypeCode)?void 0:t.includes(d.cellType)}))))),d.status&&(e=e.filter((e=>e.status===d.status))),(d.dateRange.start||d.dateRange.end)&&(e=e.filter((e=>{const t=new Date(e.orderDate);if(d.dateRange.start&&d.dateRange.end){const e=new Date(d.dateRange.start),a=new Date(d.dateRange.end);return t>=e&&t<=a}if(d.dateRange.start){return t>=new Date(d.dateRange.start)}if(d.dateRange.end){return t<=new Date(d.dateRange.end)}return!0}))),d.priorityLevel&&(e=e.filter((e=>e.priority===d.priorityLevel))),d.customerName&&(e=e.filter((e=>{var t,a;return null==(a=null==(t=e.customerInfo)?void 0:t.name)?void 0:a.toLowerCase().includes(d.customerName.toLowerCase())}))),d.riskLevel&&(e=e.filter((e=>e.riskLevel===d.riskLevel))),e.sort(((e,t)=>{let a=v(e,c.field),r=v(t,c.field);return"orderDate"!==c.field&&"createdAt"!==c.field&&"updatedAt"!==c.field||(a=a?new Date(a).getTime():0,r=r?new Date(r).getTime():0),"asc"===c.direction?a>r?1:a<r?-1:0:a<r?1:a>r?-1:0})),e})),g=s((()=>{const e=(u.currentPage-1)*u.itemsPerPage,t=e+u.itemsPerPage;return m.value.slice(e,t)})),y=s((()=>{const e=new Set;return n.value.forEach((t=>{var a;(null==(a=t.customerInfo)?void 0:a.name)&&e.add(t.customerInfo.name)})),Array.from(e).sort()})),f=s((()=>{const e=new Set;return n.value.forEach((t=>{t.cells&&t.cells.length&&t.cells.forEach((t=>{t.productTypeCode&&e.add(t.productTypeCode)}))})),Array.from(e).sort()}));function v(e,t){return t.split(".").reduce(((e,t)=>e&&void 0!==e[t]?e[t]:null),e)}async function h(){try{if(i.value=!0,window.firebase&&window.firebase.firestore){const e=await window.firebase.firestore().collection("orders").orderBy("createdAt","desc").get(),t=[];return e.forEach((e=>{var a,r;const s=e.data();t.push({id:e.id,...s,createdAt:(null==(a=s.createdAt)?void 0:a.toDate())||new Date,updatedAt:(null==(r=s.updatedAt)?void 0:r.toDate())||new Date})})),n.value=t,o.value=t.length,await k(t),t}{const e=N();return n.value=e,o.value=e.length,await k(e),e}}catch(t){e("Siparişler yüklenemedi: "+t.message,"error");const a=N();return n.value=a,o.value=a.length,a}finally{i.value=!1}}async function k(e){for(const t of e)if("delayed"===t.status)t.riskLevel="high";else if("in_progress"===t.status&&t.progress<40)t.riskLevel="medium";else if("planned"===t.status&&"high"===t.priority)t.riskLevel="medium";else if("completed"===t.status)t.riskLevel="low";else{const e=["low","medium","low"],a=Math.floor(Math.random()*e.length);t.riskLevel=e[a]}}async function b(){if(d.searchQuery)try{p.value=!0;const t=d.searchQuery.toLowerCase();L(),t.includes("gecik")&&(d.status="delayed"),(t.includes("yüksek öncelik")||t.includes("acil"))&&(d.priorityLevel="high"),t.includes("risk")&&(d.riskLevel="high");const a=y.value;for(const e of a)if(t.includes(e.toLowerCase())){d.customerName=e;break}const r=f.value;for(const e of r)if(t.includes(e.toLowerCase())){d.cellType=e;break}e("AI filtreleri uygulandı","success"),d.searchQuery=""}catch(t){e("AI filtresi uygulanamadı: "+t.message,"error")}finally{p.value=!1}else e("Lütfen önce bir arama sorgusu girin","info")}function A(){u.currentPage<u.totalPages&&u.currentPage++}function D(){u.currentPage>1&&u.currentPage--}function w(e){e>=1&&e<=u.totalPages&&(u.currentPage=e)}function P(e){c.field===e?c.direction="asc"===c.direction?"desc":"asc":(c.field=e,c.direction="desc")}function L(){Object.assign(d,{searchQuery:"",cellType:"",status:"",dateRange:{start:"",end:""},priorityLevel:"",customerName:"",riskLevel:""})}function T(e){return{planned:"Planlandı",in_progress:"Devam Ediyor",delayed:"Gecikiyor",completed:"Tamamlandı",canceled:"İptal Edildi"}[e]||e}function R(e){return{planned:"status-badge status-planned",in_progress:"status-badge status-progress",delayed:"status-badge status-delayed",completed:"status-badge status-completed",canceled:"status-badge status-canceled"}[e]||""}function N(){return[{id:"order-001",orderNo:"#0424-1251",orderDate:"2024-04-01",customerInfo:{name:"AYEDAŞ",documentNo:"PO-2024-A156",contactPerson:"Ahmet Yılmaz"},cells:[{productTypeCode:"RM 36 CB",technicalValues:"36kV 630A 16kA Kesicili ÇIKIŞ Hücresi",quantity:1,deliveryDate:"2024-11-15"}],status:"delayed",progress:65,priority:"high",createdAt:new Date("2024-04-01"),updatedAt:new Date("2024-04-15")},{id:"order-002",orderNo:"#0424-1245",orderDate:"2024-04-05",customerInfo:{name:"BEDAŞ",documentNo:"PO-2024-B789",contactPerson:"Mehmet Demir"},cells:[{productTypeCode:"RM 36 LB",technicalValues:"36kV 630A 16kA Yük Ayırıcılı Giriş Hücresi",quantity:2,deliveryDate:"2024-11-20"},{productTypeCode:"RM 36 CB",technicalValues:"36kV 630A 16kA Kesicili ÇIKIŞ Hücresi",quantity:3,deliveryDate:"2024-11-20"}],status:"in_progress",progress:35,priority:"medium",createdAt:new Date("2024-04-05"),updatedAt:new Date("2024-04-10")},{id:"order-003",orderNo:"#0424-1239",orderDate:"2024-04-08",customerInfo:{name:"TOROSLAR EDAŞ",documentNo:"PO-2024-T321",contactPerson:"Zeynep Kaya"},cells:[{productTypeCode:"RM 36 FL",technicalValues:"36kV 200A 16kA Sigortalı Yük Ayırıcılı TR.Koruma Hücresi",quantity:2,deliveryDate:"2024-12-05"}],status:"planned",progress:10,priority:"low",createdAt:new Date("2024-04-08"),updatedAt:new Date("2024-04-08")},{id:"order-004",orderNo:"#0424-1233",orderDate:"2024-03-25",customerInfo:{name:"ENERJİSA",documentNo:"PO-2024-E456",contactPerson:"Can Demir"},cells:[{productTypeCode:"RM 36 LB",technicalValues:"36kV 630A 16kA Yük Ayırıcılı Giriş Hücresi",quantity:1,deliveryDate:"2024-12-05"}],status:"completed",progress:100,priority:"medium",createdAt:new Date("2024-03-25"),updatedAt:new Date("2024-04-17")},{id:"order-005",orderNo:"#0424-1220",orderDate:"2024-03-15",customerInfo:{name:"OSMANİYE ELEKTRİK",documentNo:"PO-2024-O789",contactPerson:"Ali Yıldız"},cells:[{productTypeCode:"RM 36 FL",technicalValues:"36kV 200A 16kA Sigortalı Yük Ayırıcılı TR.Koruma Hücresi",quantity:1,deliveryDate:"2024-10-30"}],status:"planned",progress:5,priority:"low",createdAt:new Date("2024-03-15"),updatedAt:new Date("2024-03-15")},{id:"order-006",orderNo:"#0424-1219",orderDate:"2024-03-14",customerInfo:{name:"AYEDAŞ",documentNo:"PO-2024-A157",contactPerson:"Ahmet Yılmaz"},cells:[{productTypeCode:"RM 36 CB",technicalValues:"36kV 630A 16kA Kesicili ÇIKIŞ Hücresi",quantity:2,deliveryDate:"2024-10-20"},{productTypeCode:"RM 36 FL",technicalValues:"36kV 200A 16kA Sigortalı Yük Ayırıcılı TR.Koruma Hücresi",quantity:1,deliveryDate:"2024-10-20"}],status:"in_progress",progress:75,priority:"high",createdAt:new Date("2024-03-14"),updatedAt:new Date("2024-04-20")},{id:"order-007",orderNo:"#0424-1215",orderDate:"2024-03-10",customerInfo:{name:"ÇORUH EDAŞ",documentNo:"PO-2024-C123",contactPerson:"Selin Çelik"},cells:[{productTypeCode:"RM 36 LB",technicalValues:"36kV 630A 16kA Yük Ayırıcılı Giriş Hücresi",quantity:3,deliveryDate:"2024-09-30"}],status:"delayed",progress:45,priority:"medium",createdAt:new Date("2024-03-10"),updatedAt:new Date("2024-04-18")}]}return t(v,"getNestedValue"),t(h,"loadOrders"),t(k,"calculateRiskLevels"),t(b,"applyAIFilters"),t(A,"nextPage"),t(D,"prevPage"),t(w,"goToPage"),t(P,"sortBy"),t(L,"clearFilters"),t(T,"getStatusText"),t(R,"getStatusBadgeClass"),t(N,"getDemoOrders"),l([()=>d.searchQuery,()=>d.cellType,()=>d.status,()=>d.dateRange.start,()=>d.dateRange.end,()=>d.priorityLevel,()=>d.customerName,()=>d.riskLevel],(()=>{u.currentPage=1})),{orders:n,isLoading:i,totalOrderCount:o,filters:d,sorting:c,pagination:u,isAiFiltering:p,filteredOrders:m,paginatedOrders:g,customerList:y,cellTypeList:f,loadOrders:h,nextPage:A,prevPage:D,goToPage:w,sortBy:P,clearFilters:L,getStatusText:T,getStatusBadgeClass:R,applyAIFilters:b}}t(T,"useOrders");const R={class:"order-list-view"},N={class:"card border-0"},O={class:"card-body"},I={class:"mb-3"},V={class:"row g-2"},E={class:"col-md-4"},S={class:"col-md-3"},M={class:"col-md-3"},B={class:"col-md-2"},Y={class:"table-responsive"},q={class:"table table-hover custom-table"},F={class:"progress progress-thin"},H=["onClick"],K={key:0},_={key:0,"aria-label":"Page navigation"},j={class:"pagination justify-content-center"},x=["onClick"],G=L({__name:"OrderListView",setup(e){const a=h(),{filters:r,currentPage:s,filteredOrders:l,totalPages:C,applyFilters:L,changePage:G,getPriorityClass:Q}=T(),U=t((e=>{switch(e){case"Planlandı":return"status-badge status-planned";case"Devam Ediyor":return"status-badge status-in-progress";case"Gecikmiş":return"status-badge status-delayed";case"Tamamlandı":return"status-badge status-completed";default:return"status-badge"}}),"getStatusBadgeClass"),z=t((e=>{switch(e){case"Planlandı":return"progress-bar bg-info";case"Devam Ediyor":return"progress-bar bg-warning";case"Gecikmiş":return"progress-bar bg-danger";case"Tamamlandı":return"progress-bar bg-success";default:return"progress-bar"}}),"getProgressBarClass"),Z=t((()=>{a.push({name:"OrderCreate"})}),"openNewOrderModal"),J=t((e=>{a.push({name:"OrderDetail",params:{id:e.id},query:{edit:!0}})}),"editOrder");return(e,a)=>{const h=k("router-link");return b(),n("div",R,[i("div",N,[i("div",{class:"card-header bg-transparent border-0 d-flex justify-content-between align-items-center"},[a[7]||(a[7]=i("h5",{class:"mb-0"},"Sipariş Yönetimi",-1)),i("button",{class:"btn btn-primary",onClick:Z},a[6]||(a[6]=[i("i",{class:"bi bi-plus"},null,-1),o(" Yeni Sipariş Ekle ")]))]),i("div",O,[i("div",I,[i("div",V,[i("div",E,[c(i("input",{type:"text",class:"form-control",placeholder:"Sipariş No Ara...","onUpdate:modelValue":a[0]||(a[0]=e=>p(r).orderNumber=e)},null,512),[[u,p(r).orderNumber]])]),i("div",S,[c(i("select",{class:"form-select","onUpdate:modelValue":a[1]||(a[1]=e=>p(r).cellType=e)},a[8]||(a[8]=[i("option",{value:""},"Hücre Tipi Seçin",-1),i("option",null,"RM 36 CB",-1),i("option",null,"RM 36 LB",-1),i("option",null,"RM 36 FL",-1),i("option",null,"RMU",-1)]),512),[[m,p(r).cellType]])]),i("div",M,[c(i("select",{class:"form-select","onUpdate:modelValue":a[2]||(a[2]=e=>p(r).status=e)},a[9]||(a[9]=[i("option",{value:""},"Durum Seçin",-1),i("option",null,"Planlandı",-1),i("option",null,"Devam Ediyor",-1),i("option",null,"Gecikmiş",-1),i("option",null,"Tamamlandı",-1)]),512),[[m,p(r).status]])]),i("div",B,[i("button",{class:"btn btn-outline-secondary w-100",onClick:a[3]||(a[3]=(...e)=>p(L)&&p(L)(...e))},"Filtrele")])])]),i("div",Y,[i("table",q,[a[13]||(a[13]=i("thead",null,[i("tr",null,[i("th",null,"Sipariş No"),i("th",null,"Müşteri"),i("th",null,"Hücre Tipi"),i("th",null,"Miktar"),i("th",null,"Planlanan Teslim"),i("th",null,"Durum"),i("th",null,"İlerleme"),i("th",null,"İşlemler")])],-1)),i("tbody",null,[(b(!0),n(g,null,y(p(l),(e=>(b(),n("tr",{key:e.id,class:f(p(Q)(e))},[i("td",null,A(e.id),1),i("td",null,A(e.customer),1),i("td",null,A(e.cellType),1),i("td",null,A(e.quantity),1),i("td",null,A(e.deliveryDate),1),i("td",null,[i("span",{class:f(U(e.status))},A(e.status),3)]),i("td",null,[i("div",F,[i("div",{class:f(z(e.status)),role:"progressbar",style:D({width:e.progress+"%"})},null,6)])]),i("td",null,[w(h,{to:{name:"OrderDetail",params:{id:e.id}},class:"btn btn-sm btn-outline-primary me-1"},{default:P((()=>a[10]||(a[10]=[i("i",{class:"bi bi-eye"},null,-1)]))),_:2},1032,["to"]),i("button",{class:"btn btn-sm btn-outline-secondary",onClick:t((t=>J(e)),"onClick")},a[11]||(a[11]=[i("i",{class:"bi bi-pencil"},null,-1)]),8,H)])],2)))),128)),0===p(l).length?(b(),n("tr",K,a[12]||(a[12]=[i("td",{colspan:"8",class:"text-center"},"Gösterilecek sipariş bulunamadı.",-1)]))):d("",!0)])])]),p(C)>1?(b(),n("nav",_,[i("ul",j,[i("li",{class:f(["page-item",{disabled:1===p(s)}])},[i("a",{class:"page-link",href:"#",onClick:a[4]||(a[4]=v((e=>p(G)(p(s)-1)),["prevent"]))},"Önceki")],2),(b(!0),n(g,null,y(p(C),(e=>(b(),n("li",{class:f(["page-item",{active:p(s)===e}]),key:e},[i("a",{class:"page-link",href:"#",onClick:v((t=>p(G)(e)),["prevent"])},A(e),9,x)],2)))),128)),i("li",{class:f(["page-item",{disabled:p(s)===p(C)}])},[i("a",{class:"page-link",href:"#",onClick:a[5]||(a[5]=v((e=>p(G)(p(s)+1)),["prevent"]))},"Sonraki")],2)])])):d("",!0)])])])}}},[["__scopeId","data-v-a626a2a6"]]);export{G as default};
